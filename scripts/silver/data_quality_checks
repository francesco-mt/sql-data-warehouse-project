-- QUALITY TESTS AND CHECKS


-- Returns duplicates. Expactation : no result.
SELECT 
sls_ord_num, 
COUNT(*)
FROM bronze.crm_sales_details 
GROUP BY sls_ord_num
HAVING COUNT(*) > 1 OR sls_ord_num IS NULL;

-- Returns strings with unwanted spaces. Expactation: no result.
SELECT 
sls_cust_id
FROM bronze.crm_sales_details 
WHERE sls_cust_id  != TRIM(sls_cust_id) OR sls_cust_id IS NULL;

-- Returns negative numbers or null
SELECT 
	sls_quantity
FROM bronze.crm_sales_details
WHERE sls_quantity < 0 OR sls_quantity IS NULL;

SELECT 
	DISTINCT prd_line
FROM bronze.crm_prd_info

-- Returns rows with impossible dates combination. Expectation : no result
SELECT 
	 *
FROM bronze.crm_sales_details
WHERE sls_order_dt > sls_ship_dt OR sls_order_dt > sls_due_dt


-- Returns values that are not in another column or that are null. Expactation: no result
SELECT 
	sls_cust_id	
FROM bronze.crm_sales_details s
WHERE NOT EXISTS (
	SELECT 1 
	FROM bronze.crm_cust_info c 
	WHERE c.cst_id = s.sls_cust_id
)
OR sls_cust_id IS NULL;

-- Returns invalid dates. Expectation: no result
SELECT NULLIF(sls_ship_dt, 0) sls_ship_dt
FROM bronze.crm_sales_details
WHERE sls_ship_dt <= 0
OR LEN(sls_ship_dt) != 8
OR sls_ship_dt > 20500101
OR sls_ship_dt < 19000101 

-- Returns rows in which sales, quantity and price are not coherent with one another
SELECT
* 
FROM bronze.crm_sales_details
WHERE sls_sales != sls_quantity * sls_price
OR sls_sales IS NULL OR sls_quantity IS NULL OR sls_price IS NULL
OR sls_sales <= 0 OR sls_quantity <= 0 OR sls_price <= 0
ORDER BY sls_sales DESC
